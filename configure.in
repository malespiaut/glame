dnl Process this file with autoconf to produce a configure script.
AC_INIT(configure.in)
AM_CONFIG_HEADER(config.h)
AM_INIT_AUTOMAKE(glame, 0.025)


dnl one switch to configure debugging stuff - sane default for now
AC_ARG_ENABLE(debug, [  --enable-debug          lots of debugging code ], debug=$enableval, debug=1)
if test "$debug" = "no"; then
	debug=0
elif test "$debug" = "yes"; then
	debug=2
fi
if test $debug -eq 2; then
	AC_DEFINE(DEBUG)
elif test $debug -eq 0; then
	AC_DEFINE(NDEBUG)
fi

dnl Checks for programs.
AC_PROG_CC
AC_PROG_INSTALL
AM_PROG_LIBTOOL

if test $GCC = "yes"; then
	AC_DEFINE(HAVE_GCC)
	if test $debug -lt 2; then
		CFLAGS="$CFLAGS -Wall"
	else
		CFLAGS="-Wall -g -O0"
	fi
fi

dnl
dnl Checks for libraries.
dnl use GLAME_LIBS & GLAME_CFLAGS

GLAME_LIBS=""
GLAME_CFLAGS=""



dnl GTK check
AM_PATH_GTK(1.2.0, [have_gtk=yes],
  [AC_MSG_RESULT(Test for GTK failed. See the file 'INSTALL' for help.)
  have_gtk=no])
AM_CONDITIONAL(HAVE_GTK, test x$have_gtk=xyes)

dnl GNOME check
if test x$have_gtk = xyes; then
  GNOME_INIT_HOOK([have_gnome=yes],,)
fi
AM_CONDITIONAL(HAVE_GNOME, test x$have_gnome = xyes)


dnl
dnl Checks for various audio stuff.
dnl

dnl check for libaudiofile
AC_CHECK_LIB(audiofile, afCloseFile, laf=yes, laf=no)
AC_CHECK_HEADER(audiofile.h,, laf=no)
if test $laf = yes; then
	GLAME_LIBS="$GLAME_LIBS -laudiofile"
	AC_DEFINE(HAVE_AUDIOFILE)
fi

dnl check for libsndfile - FIXME
lsf=no
if test $lsf = yes; then
	GLAME_LIBS="$GLAME_LIBS -lsndfile"
	AC_DEFINE(HAVE_SNDFILE)
fi

dnl check for esd
AM_PATH_ESD(0.2.0, esd=yes, esd=no)
if test $esd = yes; then
	GLAME_LIBS="$GLAME_LIBS $ESD_LIBS"
	GLAME_CFLAGS="$GLAME_CFLAGS $ESD_CFLAGS"
	AC_DEFINE(HAVE_ESD)
fi

dnl check for native IRIX audio
AC_CHECK_LIB(audio, alWriteBuffers, la=yes, la=no)
AC_CHECK_HEADER(dmedia/audio.h,, la=no)
if test $la = yes; then
	GLAME_LIBS="$GLAME_LIBS -laudio"
	AC_DEFINE(HAVE_SGIAUDIO)
fi


dnl check for electric fence - temp. disabled due to efence bugs(!?)
efence=""
if test $debug -eq 2; then
	AC_CHECK_LIB(efence, Page_AllowAccess, efence="-lefence")
dnl	GLAME_LIBS="$GLAME_LIBS $efence"
fi

dnl Checks for header files.
AC_HEADER_STDC
AC_HEADER_TIME
AC_HEADER_DIRENT
AC_HEADER_SYS_WAIT
AC_CHECK_HEADERS(fcntl.h sys/file.h unistd.h)



dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_INLINE
AC_TYPE_OFF_T
AC_STRUCT_ST_BLOCKS
AC_TYPE_SIGNAL
AC_TYPE_PID_T

dnl Checks for library functions.
AC_FUNC_MMAP


dnl special asm code hooks for cpu
case "$host_cpu" in
i?86)
	AC_DEFINE(CPU_X86);;
mips*)
	AC_DEFINE(CPU_MIPS);;
esac


dnl
AM_CONDITIONAL(STATICLIBS, test x$enable_static = xyes)

AC_SUBST(GLAME_LIBS)
AC_SUBST(GLAME_CFLAGS)

AC_OUTPUT(Makefile doc/Makefile src/Makefile src/filter/Makefile src/swapfile/Makefile src/hash/Makefile src/channel/Makefile src/plugin/Makefile src/include/Makefile src/gui/Makefile src/glmath/Makefile src/data/Makefile src/data/pixmaps/Makefile)
